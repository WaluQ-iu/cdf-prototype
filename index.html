<!DOCTYPE html>
<!-- 
Frontend (Next.js + Tailwind CSS + Chart.js + Leaflet.js + Framer Motion): Next.js builds the UI, 
Tailwind styles it, Chart.js and Leaflet.js handle visualizations (charts and maps), 
and Framer Motion adds animations. React Query manages data fetching.
Backend (Node.js + Express.js + Socket.IO): Node.js and Express.js serve the API, 
and Socket.IO handles real-time updates.
Database (PostgreSQL + Redis): PostgreSQL stores the data, and Redis caches it for faster access.
Security (HTTPS + JWT + Helmet.js): HTTPS encrypts traffic, JWT secures authentication, and Helmet.js protects the backend.
Performance (Vite + Cloudflare): Vite optimizes the build process, and Cloudflare enhances global performance and security.
Mobile (PWA + Tailwind): PWA ensures offline access, and Tailwind ensures responsiveness.
Deployment (Vercel + Docker): Vercel deploys the frontend, and Docker containerizes the backend for consistency.-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zambia CDF Monitoring Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #F8F9FA; }
    .header { background: #007BFF; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 16px; margin: 0; flex-grow: 1; text-align: center; }
    .header .logo { width: 40px; height: 24px; object-fit: cover; }
    .header .user { font-size: 24px; display: flex; align-items: center; gap: 5px; }
    .content { padding: 10px; padding-bottom: 60px; }
    .card { background: white; border: 1px solid #DEE2E6; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
    .card p { margin: 5px 0; font-size: 16px; }
    .card p span { font-weight: bold; }
    .chart-container { width: 100%; height: 150px; margin-bottom: 5px; position: relative; }
    .list-container { display: none; margin-bottom: 10px; position: relative; }
    .list-container ul { list-style: none; padding: 0; }
    .list-container li { padding: 8px; border-bottom: 1px solid #DEE2E6; font-size: 14px; }
    .list-container .back-btn { 
      background: #6C757D; 
      color: white; 
      padding: 4px 6px; 
      border-radius: 5px; 
      font-size: 10px; 
      cursor: pointer; 
      display: inline-block; 
      margin: 2px 0; 
      position: absolute; 
      top: 0; 
      right: 10px; 
    }
    .map-container { width: 100%; height: 150px; }
    .filter-bar { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; align-items: center; justify-content: center; }
    .filter-bar label { font-size: 14px; font-weight: bold; color: #333; }
    .filter-bar select, .filter-bar input { padding: 6px; font-size: 14px; border: 1px solid #DEE2E6; border-radius: 5px; width: 100%; max-width: 150px; }
    .filter-bar button { background: #007BFF; color: white; padding: 6px; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; width: 100%; max-width: 100px; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { border: 1px solid #DEE2E6; padding: 8px; font-size: 12px; text-align: left; }
    .table th { background: #007BFF; color: white; }
    .progress-bar { background: #DEE2E6; height: 8px; border-radius: 4px; }
    .progress-bar div { height: 100%; border-radius: 4px; }
    .alerts { margin-bottom: 10px; }
    .alert { background: #DC3545; color: white; padding: 8px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
    .alert button { background: #007BFF; color: white; border: none; padding: 5px; border-radius: 3px; cursor: pointer; }
    .form-section { margin-bottom: 10px; }
    .form-section label { display: block; font-size: 14px; margin-bottom: 5px; }
    .form-section input, .form-section select, .form-section textarea { width: 100%; padding: 8px; font-size: 16px; border: 1px solid #DEE2E6; border-radius: 5px; }
    .form-section button { background: #a72865; color: white; padding: 10px; font-size: 16px; border: none; border-radius: 5px; width: 100%; }
    .form-section button:disabled { background: #6C757D; }
    .footer { 
      background: #F8F9FA; 
      padding: 10px; 
      display: flex; 
      justify-content: space-around; 
      border-top: 1px solid #DEE2E6; 
      flex-wrap: wrap; 
      position: fixed; 
      bottom: 0; 
      width: 100%; 
      transition: transform 0.3s ease; 
      z-index: 1000; 
    }
    .footer.hidden { transform: translateY(100%); }
    .footer a { color: #007BFF; font-size: 14px; text-decoration: none; display: flex; flex-direction: column; align-items: center; margin: 5px; }
    .footer a i { font-size: 24px; margin-bottom: 5px; }
    .footer a.active { color: #28A745; }
    .sync-btn { background: #28A745; color: white; padding: 5px; border-radius: 3px; font-size: 14px; margin: 5px; }
    .toggle-btn { 
      background: #6C757D; 
      color: white; 
      padding: 4px 6px; 
      border-radius: 5px; 
      font-size: 10px; 
      cursor: pointer; 
      display: inline-block; 
      margin: 2px 0; 
      position: absolute; 
      bottom: -20px; 
      right: 10px; 
    }
    .screen { display: none; }
    .screen.active { display: block; }
    /* Project Highlights Section */
    .goals-section { margin-bottom: 15px; display: none; }
    .goals-section.active { display: block; }
    .goals-section h2 { font-size: 16px; color: #007BFF; margin-bottom: 8px; text-align: center; }
    .goals-container { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; position: relative; }
    .goal-card { 
      background: white; 
      border: 1px solid #DEE2E6; 
      padding: 10px; 
      border-radius: 8px; 
      width: 100%; 
      max-width: 220px; 
      text-align: center; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
      transition: transform 0.3s ease; 
      position: relative; 
    }
    .goal-card:hover { transform: scale(1.05); }
    .goal-card i { font-size: 24px; color: #28A745; margin-bottom: 8px; }
    .goal-card .alert-icon { 
      position: absolute; 
      top: 5px; 
      right: 5px; 
      color: #DC3545; 
      font-size: 16px; 
      cursor: pointer; 
    }
    .goal-card h3 { font-size: 14px; margin: 8px 0; color: #333; }
    .goal-card .progress-circle { 
      width: 60px; 
      height: 60px; 
      margin: 0 auto 8px; 
      position: relative; 
      background: conic-gradient(#28A745 0% calc(var(--progress) * 3.6deg), #DEE2E6 calc(var(--progress) * 3.6deg) 100%); 
      border-radius: 50%; 
    }
    .goal-card .progress-circle::before { 
      content: attr(data-progress) '%'; 
      position: absolute; 
      top: 50%; 
      left: 50%; 
      transform: translate(-50%, -50%); 
      font-size: 14px; 
      font-weight: bold; 
      color: #333; 
      background: white; 
      width: 45px; 
      height: 45px; 
      border-radius: 50%; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }
    .goal-card p { font-size: 12px; color: #666; }
    @media (min-width: 768px) {
      .content { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .chart-container, .list-container, .map-container { height: 200px; }
      .card { grid-column: span 1; }
      .footer { flex-wrap: nowrap; }
      .filter-bar select, .filter-bar input { max-width: 180px; }
      .filter-bar button { max-width: 120px; }
      .goal-card { max-width: 200px; }
      .goals-section h2 { font-size: 18px; }
      .goal-card i { font-size: 28px; }
      .goal-card h3 { font-size: 15px; }
      .goal-card .alert-icon { font-size: 18px; }
      .goal-card .progress-circle { width: 70px; height: 70px; }
      .goal-card .progress-circle::before { font-size: 15px; width: 50px; height: 50px; }
      .goal-card p { font-size: 13px; }
      .toggle-btn, .list-container .back-btn { font-size: 12px; padding: 5px 8px; bottom: -25px; }
    }
  </style>
</head>
<body>
  <!-- Overview Dashboard -->
  <div id="overview" class="screen active">
    <div class="header">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Flag_of_Zambia.svg/320px-Flag_of_Zambia.svg.png" alt="Zambia Flag" class="logo">
      <h1>Zambia CDF Overview</h1>
      <div class="user">
        <i class="fas fa-user-circle"></i>
        <select onchange="changeLanguage(this.value)">
          <option value="en">EN</option>
          <option value="bem">Bemba</option>
          <option value="loz">Lozi</option>
          <option value="nya">Nyanja</option>
          <option value="ton">Tonga</option>

        </select>
      </div>
    </div>
    <div class="content">
      <!-- Filter Bar -->
      <div class="filter-bar">
        <label>Filter By:</label>
        <select id="overview-project-type" onchange="updateOverview()">
          <option value="all">All Projects</option>
          <option value="PAOG-Z">PAOG-Z</option>
          <option value="COMPACT">COMPACT</option>
          <option value="KUPULA">KUPULA</option>
          <option value="Other Projects">Other Projects</option>
        </select>
      </div>
      <!-- Project Summary -->
      <div class="card">
        <p><i class="fas fa-house-user"></i> Total Projects: <span id="totalProjects">0</span></p>
        <p><i class="fas fa-money-bill"></i> Funds Allocated: <span id="fundsAllocated">ZMW 0</span></p>
        <p><i class="fas fa-money-bill"></i> Funds Disbursed: <span id="fundsDisbursed">ZMW 0</span></p>
        <p><i class="fas fa-balance-scale"></i> Funds Remaining: <span id="fundsRemaining">ZMW 0</span></p>
      </div>
      <div class="chart-container" id="sector-chart">
        <canvas id="sectorChart"></canvas>
        <button onclick="exportChart('sectorChart')">Export PNG</button>
        <button class="toggle-btn" onclick="toggleView('sector')">Show List</button>
      </div>
      <div class="list-container" id="sector-list">
        <ul id="sectorList"></ul>
        <button class="back-btn" onclick="toggleView('sector')">Back to Chart</button>
      </div>
      <div class="map-container" id="map"></div>
      <!-- Project Highlights Section -->
      <div id="highlights-all" class="goals-section">
        <h2>Project Highlights Now</h2>
        <div class="goals-container">
          <!-- PAOG-Z Highlights -->
          <div class="goal-card" style="--progress: 65;" data-project-id="P1">
            <i class="fas fa-laptop"></i>
            <h3>Katondo Digital Hub</h3>
            <div class="progress-circle" data-progress="65"></div>
            <p>Train 10,000 youth<br>Progress: 6,500 trained</p>
          </div>
          <div class="goal-card" style="--progress: 40;" data-project-id="P3">
            <i class="fas fa-briefcase"></i>
            <i class="fas fa-exclamation-triangle alert-icon" onclick="showProjectDetails('P3')"></i>
            <h3>Grassroots Mentorship and Development</h3>
            <div class="progress-circle" data-progress="40"></div>
            <p>Train 5,000 Gen-Z Leaders<br>Progress: 2,000 Trained</p>
          </div>
          <div class="goal-card" style="--progress: 50;">
            <i class="fas fa-users"></i>
            <h3>Community Engagement</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Engage 50 communities<br>Progress: 25 communities</p>
          </div>
          <!-- COMPACT Highlights -->
          <div class="goal-card" style="--progress: 70;" data-project-id="L1">
            <i class="fas fa-tint"></i>
            <h3>Kanyama Borehole</h3>
            <div class="progress-circle" data-progress="70"></div>
            <p>Install 100 boreholes<br>Progress: 70 installed</p>
          </div>
          <div class="goal-card" style="--progress: 60;" data-project-id="L2">
            <i class="fas fa-school"></i>
            <h3>Kanyama School</h3>
            <div class="progress-circle" data-progress="60"></div>
            <p>Build 50 schools<br>Progress: 30 built</p>
          </div>
          <div class="goal-card" style="--progress: 62.5;" data-project-id="L3">
            <i class="fas fa-hospital"></i>
            <h3>Kanyama Clinic</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Upgrade 40 clinics<br>Progress: 25 upgraded</p>
          </div>
          <!-- KUPULA Highlights -->
          <div class="goal-card" style="--progress: 62.5;" data-project-id="KUP1">
            <i class="fas fa-solar-panel"></i>
            <h3>Kapiri Solar Irrigation</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Install 80 systems<br>Progress: 50 installed</p>
          </div>
          <div class="goal-card" style="--progress: 58.3;" data-project-id="KUP2">
            <i class="fas fa-leaf"></i>
            <h3>Lukanga Organic Farming</h3>
            <div class="progress-circle" data-progress="58.3"></div>
            <p>Establish 60 hubs<br>Progress: 35 established</p>
          </div>
          <div class="goal-card" style="--progress: 40;" data-project-id="KUP3">
            <i class="fas fa-fish"></i>
            <i class="fas fa-exclamation-triangle alert-icon" onclick="showProjectDetails('KUP3')"></i>
            <h3>Chibombo Fish Farming</h3>
            <div class="progress-circle" data-progress="40"></div>
            <p>Support 50 projects<br>Progress: 20 supported</p>
          </div>
          <!-- Other Projects Highlights -->
          <div class="goal-card" style="--progress: 50;" data-project-id="O3">
            <i class="fas fa-building"></i>
            <h3>Kanyama Library</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Build 30 centers<br>Progress: 15 built</p>
          </div>
          <div class="goal-card" style="--progress: 62.5;" data-project-id="O1">
            <i class="fas fa-store"></i>
            <h3>Livingstone Market</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Establish 40 markets<br>Progress: 25 established</p>
          </div>
          <div class="goal-card" style="--progress: 50;" data-project-id="O4">
            <i class="fas fa-futbol"></i>
            <h3>Ndola Sports Facility</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Develop 20 facilities<br>Progress: 10 developed</p>
          </div>
        </div>
      </div>
      <div id="highlights-paogz" class="goals-section">
        <h2>Project Highlights Now</h2>
        <div class="goals-container">
          <div class="goal-card" style="--progress: 65;" data-project-id="P1">
            <i class="fas fa-laptop"></i>
            <h3>Katondo Digital Hub</h3>
            <div class="progress-circle" data-progress="65"></div>
            <p>Train 10,000 youth<br>Progress: 6,500 trained</p>
          </div>
          <div class="goal-card" style="--progress: 40;" data-project-id="P3">
            <i class="fas fa-briefcase"></i>
            <i class="fas fa-exclamation-triangle alert-icon" onclick="showProjectDetails('P3')"></i>
            <h3>Chibombo Mentorship</h3>
            <div class="progress-circle" data-progress="40"></div>
            <p>Train 5,000 Gen-Z Leaders<br>Progress: 2,000 Trained</p>
          </div>
          <div class="goal-card" style="--progress: 50;">
            <i class="fas fa-users"></i>
            <h3>Community Engagement</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Engage 50 communities<br>Progress: 25 communities</p>
          </div>
        </div>
      </div>
      <div id="highlights-compact" class="goals-section">
        <h2>Project Highlights Now</h2>
        <div class="goals-container">
          <div class="goal-card" style="--progress: 70;" data-project-id="L1">
            <i class="fas fa-tint"></i>
            <h3>Kanyama Borehole</h3>
            <div class="progress-circle" data-progress="70"></div>
            <p>Install 100 boreholes<br>Progress: 70 installed</p>
          </div>
          <div class="goal-card" style="--progress: 60;" data-project-id="L2">
            <i class="fas fa-school"></i>
            <h3>Kanyama School</h3>
            <div class="progress-circle" data-progress="60"></div>
            <p>Build 50 schools<br>Progress: 30 built</p>
          </div>
          <div class="goal-card" style="--progress: 62.5;" data-project-id="L3">
            <i class="fas fa-hospital"></i>
            <h3>Kanyama Clinic</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Upgrade 40 clinics<br>Progress: 25 upgraded</p>
          </div>
        </div>
      </div>
      <div id="highlights-kupula" class="goals-section">
        <h2>Project Highlights Now</h2>
        <div class="goals-container">
          <div class="goal-card" style="--progress: 62.5;" data-project-id="KUP1">
            <i class="fas fa-solar-panel"></i>
            <h3>Kapiri Solar Irrigation</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Install 80 systems<br>Progress: 50 installed</p>
          </div>
          <div class="goal-card" style="--progress: 58.3;" data-project-id="KUP2">
            <i class="fas fa-leaf"></i>
            <h3>Lukanga Organic Farming</h3>
            <div class="progress-circle" data-progress="58.3"></div>
            <p>Establish 60 hubs<br>Progress: 35 established</p>
          </div>
          <div class="goal-card" style="--progress: 40;" data-project-id="KUP3">
            <i class="fas fa-fish"></i>
            <i class="fas fa-exclamation-triangle alert-icon" onclick="showProjectDetails('KUP3')"></i>
            <h3>Chibombo Fish Farming</h3>
            <div class="progress-circle" data-progress="40"></div>
            <p>Support 50 projects<br>Progress: 20 supported</p>
          </div>
        </div>
      </div>
      <div id="highlights-other" class="goals-section">
        <h2>Project Highlights Now</h2>
        <div class="goals-container">
          <div class="goal-card" style="--progress: 50;" data-project-id="O3">
            <i class="fas fa-building"></i>
            <h3>Kanyama Library</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Build 30 centers<br>Progress: 15 built</p>
          </div>
          <div class="goal-card" style="--progress: 62.5;" data-project-id="O1">
            <i class="fas fa-store"></i>
            <h3>Livingstone Market</h3>
            <div class="progress-circle" data-progress="62.5"></div>
            <p>Establish 40 markets<br>Progress: 25 established</p>
          </div>
          <div class="goal-card" style="--progress: 50;" data-project-id="O4">
            <i class="fas fa-futbol"></i>
            <h3>Ndola Sports Facility</h3>
            <div class="progress-circle" data-progress="50"></div>
            <p>Develop 20 facilities<br>Progress: 10 developed</p>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <a href="#overview" class="active"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
      <button class="sync-btn" id="sync">Sync Data</button>
    </div>
  </div>

  <!-- Project Status Dashboard -->
  <div id="project-status" class="screen">
    <div class="header">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Flag_of_Zambia.svg/320px-Flag_of_Zambia.svg.png" alt="Zambia Flag" class="logo">
      <h1>Project Status</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="filter-bar">
        <select id="level" onchange="updateFilters()">
          <option value="national">National</option>
          <option value="province">Province</option>
          <option value="district">District</option>
          <option value="constituency">Constituency</option>
          <option value="ward">Ward</option>
        </select>
        <select id="province" onchange="filterProjects()" style="display: none;">
          <option value="all">All Provinces</option>
          <option value="lusaka">Lusaka</option>
          <option value="central">Central</option>
          <option value="copperbelt">Copperbelt</option>
          <option value="southern">Southern</option>
          <option value="western">Western</option>
          <option value="muchinga">Muchinga</option>
          <option value="eastern">Eastern</option>
        </select>
        <select id="district" onchange="filterProjects()" style="display: none;">
          <option value="all">All Districts</option>
          <option value="lusaka">Lusaka</option>
          <option value="chilanga">Chilanga</option>
          <option value="kafue">Kafue</option>
          <option value="kabwe central">Kabwe Central</option>
          <option value="chibombo">Chibombo</option>
          <option value="kapiri mposhi">Kapiri Mposhi</option>
          <option value="ndola central">Ndola Central</option>
          <option value="nkana">Nkana</option>
          <option value="livingstone">Livingstone</option>
          <option value="mongu">Mongu</option>
          <option value="shangombo">Shangombo</option>
          <option value="mpika">Mpika</option>
          <option value="chipata">Chipata</option>
        </select>
        <select id="constituency" onchange="filterProjects()" style="display: none;">
          <option value="in-dev">(In-dev)</option>
        </select>
        <select id="ward" onchange="filterProjects()" style="display: none;">
          <option value="in-dev">(In-dev)</option>
        </select>
        <select id="sector" onchange="filterProjects()">
          <option value="all">All Sectors</option>
          <option value="education">Education</option>
          <option value="water">Water</option>
          <option value="skills">Skills</option>
          <option value="health">Health</option>
          <option value="agriculture">Agriculture</option>
          <option value="community">Community</option>
        </select>
        <select id="status" onchange="filterProjects()">
          <option value="all">All Status</option>
          <option value="ongoing">Ongoing</option>
          <option value="completed">Completed</option>
          <option value="delayed">Delayed</option>
        </select>
        <select id="project-type" onchange="filterProjects()">
          <option value="all">All Projects</option>
          <option value="PAOG-Z">PAOG-Z</option>
          <option value="COMPACT">COMPACT</option>
          <option value="KUPULA">KUPULA</option>
          <option value="Other Projects">Other Projects</option>
        </select>
        <input id="search" type="text" placeholder="Search Project">
        <button onclick="filterProjects()">Apply</button>
        <button onclick="searchProjects()">Search</button>
      </div>
      <div class="chart-container" id="status-chart">
        <canvas id="statusChart"></canvas>
        <button onclick="exportChart('statusChart')">Export PNG</button>
        <button class="toggle-btn" onclick="toggleView('status')">Show List</button>
      </div>
      <div class="list-container" id="status-list">
        <ul id="statusList"></ul>
        <button class="back-btn" onclick="toggleView('status')">Back to Chart</button>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Project Type</th>
            <th>Province</th>
            <th>District</th>
            <th>Sector</th>
            <th>Progress</th>
            <th>Funds</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="projectTable"></tbody>
      </table>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status" class="active"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Financial Dashboard -->
  <div id="financial" class="screen">
    <div class="header">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Flag_of_Zambia.svg/320px-Flag_of_Zambia.svg.png" alt="Zambia Flag" class="logo">
      <h1>Financial Overview</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="card">
        <p><i class="fas fa-money-bill"></i> Funds Allocated: <span id="financialFundsAllocated">ZMW 0</span></p>
        <canvas id="gaugeChart" height="100"></canvas>
        <p style="text-align: center; font-size: 18px;" id="gaugeLabel">ZMW 0 / 0</p>
      </div>
      <div class="chart-container" id="trend-chart">
        <canvas id="trendChart"></canvas>
        <button onclick="exportChart('trendChart')">Export PNG</button>
        <button class="toggle-btn" onclick="toggleView('trend')">Show List</button>
      </div>
      <div class="list-container" id="trend-list">
        <ul id="trendList"></ul>
        <button class="back-btn" onclick="toggleView('trend')">Back to Chart</button>
      </div>
      <div class="alerts">
        <div class="alert">Overdue: School ZMW 200K <button onclick="resolveAlert()">Resolve</button></div>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Action</th>
            <th>Project</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>10/04/25</td>
            <td>Site Visit</td>
            <td>Borehole</td>
            <td>OK</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial" class="active"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Project Proposal Form -->
  <div id="proposal" class="screen">
    <div class="header">
      <i class="fas fa-arrow-left" onclick="goBack()"></i>
      <h1>Submit CDF Project Proposal</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="form-section">
        <label>Project Type</label>
        <select id="proposalProjectType" required>
          <option value="">Select</option>
          <option value="PAOG-Z">PAOG-Z</option>
          <option value="COMPACT">COMPACT</option>
          <option value="KUPULA">KUPULA</option>
          <option value="Other Projects">Other Projects</option>
        </select>
      </div>
      <div class="form-section">
        <label>Project Name</label>
        <input type="text" placeholder="e.g., Kanyama Clinic" required>
      </div>
      <div class="form-section">
        <label>Description</label>
        <textarea placeholder="Describe the project..." maxlength="200" required></textarea>
      </div>
      <div class="form-section">
        <label>Budget (ZMW)</label>
        <input type="number" placeholder="e.g., 500000" required>
      </div>
      <div class="form-section">
        <label>Start Date</label>
        <input type="date" required>
      </div>
      <div class="form-section">
        <label>Community Endorsement</label>
        <input type="text" placeholder="e.g., Ward meeting 10/04/25" required>
      </div>
      <div class="form-section">
        <label>Photo/Letter</label>
        <input type="file" accept=".jpg,.pdf">
      </div>
      <div class="form-section">
        <button id="submitProposal" disabled>Submit Proposal</button>
      </div>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal" class="active"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Community Feedback Interface -->
  <div id="feedback" class="screen">
    <div class="header">
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Flag_of_Zambia.svg/320px-Flag_of_Zambia.svg.png" alt="Zambia Flag" class="logo">
      <h1>Community Feedback</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="form-section">
        <label>Project</label>
        <select id="feedbackProject" required>
          <option value="all">All Projects</option>
        </select>
      </div>
      <div class="form-section">
        <label>Issue Type</label>
        <select required>
          <option value="">Select</option>
          <option value="quality">Quality</option>
          <option value="delay">Delay</option>
          <option value="misuse">Misuse</option>
        </select>
      </div>
      <div class="form-section">
        <label>Details</label>
        <textarea placeholder="Describe the issue..." maxlength="150" required></textarea>
      </div>
      <div class="form-section">
        <label>Photo (Optional)</label>
        <input type="file" accept=".jpg">
      </div>
      <div class="form-section">
        <label><input type="checkbox" checked> Submit Anonymously</label>
      </div>
      <div class="form-section">
        <button id="submitFeedback">Send Feedback</button>
      </div>
      <div class="form-section">
        <label>Check Project Status</label>
        <input type="text" placeholder="Enter Project ID" id="statusId">
        <button onclick="checkStatus()">Check</button>
        <p id="statusResult"></p>
      </div>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback" class="active"><i class="fas fa-comment"></i> Feedback</a>
      <p>Contact: +260 123 456 789</p>
    </div>
  </div>

    <!-- Future modules-->
    <div id="fmodules" class="screen">
        <div class="header">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Flag_of_Zambia.svg/320px-Flag_of_Zambia.svg.png" alt="Zambia Flag" class="logo">
          <h1>Future Modules</h1>
          <div class="user"><i class="fas fa-user-circle"></i></div>
        </div>
        <div class="content">
          <div class="form-section">
            <label>FutureDevs</label>
            <select id="FutureModules" required>
              <option value="all">All Projects</option>
            </select>
          </div>
    
        </div>
        <div class="footer">
          <a href="#overview"><i class="fas fa-home"></i> Overview</a>
          <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
          <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
          <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
          <a href="#feedback" class="active"><i class="fas fa-comment"></i> Feedback</a>
          <p>Contact: +260 123 456 789</p>
        </div>
      </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Dummy Data with Province and District
    const projects = [
      { projectType: 'COMPACT', id: 'L1', name: 'Kanyama Borehole', province: 'lusaka', district: 'lusaka', sector: 'water', progress: 75, funds: 400000, status: 'ongoing', lat: -15.3875, lng: 28.3228 },
      { projectType: 'COMPACT', id: 'L2', name: 'Kanyama School', province: 'lusaka', district: 'lusaka', sector: 'education', progress: 100, funds: 600000, status: 'completed', lat: -15.3876, lng: 28.3229 },
      { projectType: 'COMPACT', id: 'L3', name: 'Kanyama Clinic', province: 'lusaka', district: 'lusaka', sector: 'health', progress: 30, funds: 300000, status: 'ongoing', lat: -15.3877, lng: 28.3230 },
      { projectType: 'COMPACT', id: 'L4', name: 'Kanyama Skills Training', province: 'lusaka', district: 'lusaka', sector: 'skills', progress: 10, funds: 200000, status: 'delayed', lat: -15.3878, lng: 28.3231 },
      { projectType: 'COMPACT', id: 'L5', name: 'Materos Borehole', province: 'lusaka', district: 'lusaka', sector: 'water', progress: 90, funds: 450000, status: 'ongoing', lat: -15.3975, lng: 28.3328 },
      { projectType: 'COMPACT', id: 'L6', name: 'Materos School', province: 'lusaka', district: 'lusaka', sector: 'education', progress: 50, funds: 500000, status: 'ongoing', lat: -15.3976, lng: 28.3329 },
      { projectType: 'COMPACT', id: 'L7', name: 'Materos Clinic', province: 'lusaka', district: 'lusaka', sector: 'health', progress: 20, funds: 250000, status: 'delayed', lat: -15.3977, lng: 28.3330 },
      { projectType: 'COMPACT', id: 'L8', name: 'Materos Skills Training', province: 'lusaka', district: 'lusaka', sector: 'skills', progress: 85, funds: 300000, status: 'ongoing', lat: -15.3978, lng: 28.3331 },
      { projectType: 'COMPACT', id: 'C1', name: 'Chilanga Borehole', province: 'lusaka', district: 'chilanga', sector: 'water', progress: 60, funds: 380000, status: 'ongoing', lat: -15.6075, lng: 28.2828 },
      { projectType: 'COMPACT', id: 'C2', name: 'Chilanga School', province: 'lusaka', district: 'chilanga', sector: 'education', progress: 95, funds: 550000, status: 'completed', lat: -15.6076, lng: 28.2829 },
      { projectType: 'COMPACT', id: 'C3', name: 'Chilanga Clinic', province: 'lusaka', district: 'chilanga', sector: 'health', progress: 40, funds: 320000, status: 'ongoing', lat: -15.6077, lng: 28.2830 },
      { projectType: 'COMPACT', id: 'C4', name: 'Chilanga Skills Training', province: 'lusaka', district: 'chilanga', sector: 'skills', progress: 5, funds: 150000, status: 'delayed', lat: -15.6078, lng: 28.2831 },
      { projectType: 'COMPACT', id: 'C5', name: 'Mapepe Borehole', province: 'lusaka', district: 'chilanga', sector: 'water', progress: 70, funds: 400000, status: 'ongoing', lat: -15.6175, lng: 28.2928 },
      { projectType: 'COMPACT', id: 'C6', name: 'Mapepe School', province: 'lusaka', district: 'chilanga', sector: 'education', progress: 25, funds: 450000, status: 'ongoing', lat: -15.6176, lng: 28.2929 },
      { projectType: 'COMPACT', id: 'C7', name: 'Mapepe Clinic', province: 'lusaka', district: 'chilanga', sector: 'health', progress: 80, funds: 350000, status: 'ongoing', lat: -15.6177, lng: 28.2930 },
      { projectType: 'COMPACT', id: 'C8', name: 'Mapepe Skills Training', province: 'lusaka', district: 'chilanga', sector: 'skills', progress: 15, funds: 180000, status: 'delayed', lat: -15.6178, lng: 28.2931 },
      { projectType: 'COMPACT', id: 'K1', name: 'Kafue Borehole', province: 'lusaka', district: 'kafue', sector: 'water', progress: 85, funds: 420000, status: 'ongoing', lat: -15.7675, lng: 28.1828 },
      { projectType: 'COMPACT', id: 'K2', name: 'Kafue School', province: 'lusaka', district: 'kafue', sector: 'education', progress: 100, funds: 600000, status: 'completed', lat: -15.7676, lng: 28.1829 },
      { projectType: 'COMPACT', id: 'K3', name: 'Kafue Clinic', province: 'lusaka', district: 'kafue', sector: 'health', progress: 55, funds: 340000, status: 'ongoing', lat: -15.7677, lng: 28.1830 },
      { projectType: 'COMPACT', id: 'K4', name: 'Kafue Skills Training', province: 'lusaka', district: 'kafue', sector: 'skills', progress: 30, funds: 200000, status: 'ongoing', lat: -15.7678, lng: 28.1831 },
      { projectType: 'COMPACT', id: 'K5', name: 'Shikoswe Borehole', province: 'lusaka', district: 'kafue', sector: 'water', progress: 45, funds: 390000, status: 'ongoing', lat: -15.7775, lng: 28.1928 },
      { projectType: 'COMPACT', id: 'K6', name: 'Shikoswe School', province: 'lusaka', district: 'kafue', sector: 'education', progress: 90, funds: 580000, status: 'completed', lat: -15.7776, lng: 28.1929 },
      { projectType: 'COMPACT', id: 'K7', name: 'Shikoswe Clinic', province: 'lusaka', district: 'kafue', sector: 'health', progress: 10, funds: 280000, status: 'delayed', lat: -15.7777, lng: 28.1930 },
      { projectType: 'COMPACT', id: 'K8', name: 'Shikoswe Skills Training', province: 'lusaka', district: 'kafue', sector: 'skills', progress: 65, funds: 250000, status: 'ongoing', lat: -15.7778, lng: 28.1931 },
      { projectType: 'COMPACT', id: 'M1', name: 'Mongu Borehole', province: 'western', district: 'mongu', sector: 'water', progress: 60, funds: 410000, status: 'ongoing', lat: -15.2484, lng: 23.1274 },
      { projectType: 'COMPACT', id: 'CH1', name: 'Chipata School Renovation', province: 'eastern', district: 'chipata', sector: 'education', progress: 70, funds: 480000, status: 'ongoing', lat: -13.6333, lng: 32.6500 },
      { projectType: 'PAOG-Z', id: 'P1', name: 'Katondo Digital Hub', province: 'central', district: 'kabwe central', sector: 'skills', progress: 80, funds: 500000, status: 'ongoing', lat: -14.4400, lng: 28.4500 },
      { projectType: 'PAOG-Z', id: 'P2', name: 'Mukobeko Youth Campaign', province: 'central', district: 'kabwe central', sector: 'education', progress: 60, funds: 300000, status: 'ongoing', lat: -14.4500, lng: 28.4600 },
      { projectType: 'PAOG-Z', id: 'P3', name: 'Chibombo Grassroots development.', province: 'central', district: 'chibombo', sector: 'skills', progress: 40, funds: 450000, status: 'delayed', lat: -14.6500, lng: 28.0700 },
      { projectType: 'PAOG-Z', id: 'P4', name: 'Mungule Digital Literacy', province: 'central', district: 'chibombo', sector: 'education', progress: 70, funds: 400000, status: 'ongoing', lat: -14.6600, lng: 28.0800 },
      { projectType: 'PAOG-Z', id: 'P5', name: 'Ndeke Youth Empowerment', province: 'copperbelt', district: 'ndola central', sector: 'skills', progress: 55, funds: 350000, status: 'ongoing', lat: -12.9600, lng: 28.6400 },
      { projectType: 'PAOG-Z', id: 'P6', name: 'Chipulukusu Skills Training', province: 'copperbelt', district: 'ndola central', sector: 'skills', progress: 65, funds: 380000, status: 'ongoing', lat: -12.9800, lng: 28.6600 },
      { projectType: 'PAOG-Z', id: 'P7', name: 'Nkana East Digital Hub', province: 'copperbelt', district: 'nkana', sector: 'skills', progress: 90, funds: 520000, status: 'completed', lat: -12.8000, lng: 28.2100 },
      { projectType: 'PAOG-Z', id: 'P8', name: 'Nkana West Youth Workshop', province: 'copperbelt', district: 'nkana', sector: 'education', progress: 45, funds: 320000, status: 'ongoing', lat: -12.8100, lng: 28.2200 },
      { projectType: 'KUPULA', id: 'KUP1', name: 'Kapiri Solar Irrigation', province: 'central', district: 'kapiri mposhi', sector: 'agriculture', progress: 70, funds: 600000, status: 'ongoing', lat: -13.9700, lng: 28.6700 },
      { projectType: 'KUPULA', id: 'KUP2', name: 'Lukanga Organic Farming', province: 'central', district: 'kapiri mposhi', sector: 'agriculture', progress: 50, funds: 450000, status: 'ongoing', lat: -13.9800, lng: 28.6800 },
      { projectType: 'KUPULA', id: 'KUP3', name: 'Chibombo Fish Farming', province: 'central', district: 'chibombo', sector: 'agriculture', progress: 30, funds: 400000, status: 'delayed', lat: -14.6501, lng: 28.0701 },
      { projectType: 'KUPULA', id: 'KUP4', name: 'Kafue Urban Farming', province: 'lusaka', district: 'kafue', sector: 'agriculture', progress: 85, funds: 500000, status: 'ongoing', lat: -15.7679, lng: 28.1832 },
      { projectType: 'KUPULA', id: 'S1', name: 'Shangombo Fish Farming', province: 'western', district: 'shangombo', sector: 'agriculture', progress: 45, funds: 380000, status: 'ongoing', lat: -16.3167, lng: 22.0667 },
      { projectType: 'Other Projects', id: 'O1', name: 'Livingstone Market', province: 'southern', district: 'livingstone', sector: 'community', progress: 60, funds: 550000, status: 'ongoing', lat: -17.8500, lng: 25.8600 },
      { projectType: 'Other Projects', id: 'O2', name: 'Dambwa Community Center', province: 'southern', district: 'livingstone', sector: 'community', progress: 80, funds: 480000, status: 'ongoing', lat: -17.8600, lng: 25.8700 },
      { projectType: 'Other Projects', id: 'O3', name: 'Kanyama Library', province: 'lusaka', district: 'lusaka', sector: 'community', progress: 40, funds: 350000, status: 'ongoing', lat: -15.3879, lng: 28.3232 },
      { projectType: 'Other Projects', id: 'O4', name: 'Ndola Sports Facility', province: 'copperbelt', district: 'ndola central', sector: 'community', progress: 65, funds: 420000, status: 'ongoing', lat: -12.9601, lng: 28.6401 },
      { projectType: 'Other Projects', id: 'M2', name: 'Mongu Community Library', province: 'western', district: 'mongu', sector: 'community', progress: 55, funds: 390000, status: 'ongoing', lat: -15.2485, lng: 23.1275 },
      { projectType: 'Other Projects', id: 'MP1', name: 'Mpika Sports Complex', province: 'muchinga', district: 'mpika', sector: 'community', progress: 50, funds: 400000, status: 'ongoing', lat: -11.8333, lng: 31.4500 }
    ];

    // Financial Trend Data
    const financialTrend = {
      'PAOG-Z': [
        { month: 'Jan', disbursed: 1.5 },
        { month: 'Feb', disbursed: 2.0 },
        { month: 'Mar', disbursed: 2.5 },
        { month: 'Apr', disbursed: 3.2 }
      ],
      'COMPACT': [
        { month: 'Jan', disbursed: 5.0 },
        { month: 'Feb', disbursed: 10.0 },
        { month: 'Mar', disbursed: 15.0 },
        { month: 'Apr', disbursed: 20.5 }
      ],
      'KUPULA': [
        { month: 'Jan', disbursed: 1.0 },
        { month: 'Feb', disbursed: 1.5 },
        { month: 'Mar', disbursed: 2.0 },
        { month: 'Apr', disbursed: 2.5 }
      ],
      'Other Projects': [
        { month: 'Jan', disbursed: 0.8 },
        { month: 'Feb', disbursed: 1.2 },
        { month: 'Mar', disbursed: 1.8 },
        { month: 'Apr', disbursed: 2.2 }
      ]
    };

    // Navigation
    document.querySelectorAll('.footer a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
        document.querySelector(link.getAttribute('href')).classList.add('active');
        document.querySelectorAll('.footer a').forEach(a => a.classList.remove('active'));
        link.classList.add('active');
        if (link.getAttribute('href') === '#project-status') {
          filterProjects();
        } else if (link.getAttribute('href') === '#financial') {
          updateFinancialDashboard();
        }
      });
    });

    // Footer Scroll Behavior
    let lastScrollTop = 0;
    window.addEventListener('scroll', () => {
      const footer = document.querySelector('.footer');
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      if (scrollTop > lastScrollTop) {
        footer.classList.add('hidden');
      } else {
        footer.classList.remove('hidden');
      }
      lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });

    // Overview Chart
    function updateOverview() {
      const projectType = document.getElementById('overview-project-type').value;
      let filteredProjects = projectType === 'all' ? projects : projects.filter(p => p.projectType === projectType);

      const highlightsIdMap = {
        'all': 'highlights-all',
        'PAOG-Z': 'highlights-paogz',
        'COMPACT': 'highlights-compact',
        'KUPULA': 'highlights-kupula',
        'Other Projects': 'highlights-other'
      };

      document.querySelectorAll('.goals-section').forEach(section => section.classList.remove('active'));
      const highlightsSectionId = highlightsIdMap[projectType];
      const highlightsSection = document.getElementById(highlightsSectionId);
      if (highlightsSection) {
        highlightsSection.classList.add('active');
      }

      const sectorCounts = {
        education: 0, water: 0, skills: 0, health: 0, agriculture: 0, community: 0
      };
      let totalFunds = 0;
      filteredProjects.forEach(p => {
        sectorCounts[p.sector] += p.funds;
        totalFunds += p.funds;
      });
      const sectorData = Object.values(sectorCounts).map(val => (val / totalFunds * 100) || 0);
      const sectorLabels = ['Education', 'Water', 'Skills', 'Health', 'Agriculture', 'Community'];
      sectorChart.data.datasets[0].data = sectorData;
      sectorChart.update();
      document.getElementById('sectorList').innerHTML = sectorLabels.map((label, i) => 
        `<li>${label}: ${sectorData[i].toFixed(1)}% (ZMW ${(sectorData[i] * totalFunds / 100).toLocaleString()})</li>`
      ).join('');

      const fundsAllocated = filteredProjects.reduce((sum, p) => sum + p.funds, 0);
      const fundsDisbursed = fundsAllocated * 0.7;
      const fundsRemaining = fundsAllocated - fundsDisbursed;
      document.getElementById('totalProjects').textContent = filteredProjects.length;
      document.getElementById('fundsAllocated').textContent = `ZMW ${fundsAllocated.toLocaleString()}`;
      document.getElementById('fundsDisbursed').textContent = `ZMW ${fundsDisbursed.toLocaleString()}`;
      document.getElementById('fundsRemaining').textContent = `ZMW ${fundsRemaining.toLocaleString()}`;

      map.eachLayer(layer => {
        if (layer instanceof L.Marker) map.removeLayer(layer);
      });
      filteredProjects.forEach(p => {
        L.marker([p.lat, p.lng]).addTo(map).bindPopup(`${p.name} (${p.projectType}) - ${p.status}`);
      });
      const bounds = filteredProjects.map(p => [p.lat, p.lng]);
      if (bounds.length) map.fitBounds(bounds);
    }
    const sectorChart = new Chart(document.getElementById('sectorChart'), {
      type: 'pie',
      data: {
        labels: ['Education', 'Water', 'Skills', 'Health', 'Agriculture', 'Community'],
        datasets: [{
          data: [0, 0, 0, 0, 0, 0],
          backgroundColor: ['#007BFF', '#28A745', '#FD7E14', '#DC3545', '#6C757D', '#17A2B8']
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    const map = L.map('map').setView([-15.4167, 28.2833], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    function updateStatusChart(filteredProjects) {
      const statusCounts = { completed: 0, ongoing: 0, delayed: 0 };
      filteredProjects.forEach(p => statusCounts[p.status]++);
      statusChart.data.datasets[0].data = Object.values(statusCounts);
      statusChart.update();
      document.getElementById('statusList').innerHTML = `
        <li>Completed: ${statusCounts.completed} Projects</li>
        <li>Ongoing: ${statusCounts.ongoing} Projects</li>
        <li>Delayed: ${statusCounts.delayed} Projects</li>
      `;
    }
    const statusChart = new Chart(document.getElementById('statusChart'), {
      type: 'bar',
      data: {
        labels: ['Completed', 'Ongoing', 'Delayed'],
        datasets: [{
          label: 'Projects',
          data: [0, 0, 0],
          backgroundColor: ['#28A745', '#FFC107', '#DC3545']
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    function updateFinancialDashboard() {
      const projectType = document.getElementById('overview-project-type').value;
      let filteredProjects = projectType === 'all' ? projects : projects.filter(p => p.projectType === projectType);

      const totalFunds = filteredProjects.reduce((sum, p) => sum + p.funds, 0);
      const disbursedFunds = totalFunds * 0.7;
      gaugeChart.data.datasets[0].data = [disbursedFunds, totalFunds - disbursedFunds];
      gaugeChart.update();
      document.getElementById('financialFundsAllocated').textContent = `ZMW ${totalFunds.toLocaleString()}`;
      document.getElementById('gaugeLabel').textContent = `ZMW ${disbursedFunds.toLocaleString()} / ${totalFunds.toLocaleString()}`;

      const trendData = [];
      const allMonths = ['Jan', 'Feb', 'Mar', 'Apr'];
      allMonths.forEach(month => {
        let totalDisbursed = 0;
        ['PAOG-Z', 'COMPACT', 'KUPULA', 'Other Projects'].forEach(type => {
          if (projectType === 'all' || projectType === type) {
            const monthData = financialTrend[type].find(m => m.month === month);
            if (monthData) totalDisbursed += monthData.disbursed;
          }
        });
        trendData.push(totalDisbursed);
      });
      trendChart.data.datasets[0].data = trendData;
      trendChart.update();
      document.getElementById('trendList').innerHTML = allMonths.map((month, i) => 
        `<li>${month}: ZMW ${trendData[i].toFixed(1)}M</li>`
      ).join('');
    }
    const gaugeChart = new Chart(document.getElementById('gaugeChart'), {
      type: 'doughnut',
      data: {
        datasets: [{
          data: [0, 0],
          backgroundColor: ['#28A745', '#DEE2E6'],
          borderWidth: 0
        }]
      },
      options: { rotation: -90, circumference: 180, cutout: '80%', responsive: true }
    });
    const trendChart = new Chart(document.getElementById('trendChart'), {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr'],
        datasets: [{
          label: 'Disbursed (ZMW)',
          data: [0, 0, 0, 0],
          borderColor: '#28A745',
          fill: false
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    function validateForm() {
      const inputs = document.querySelectorAll('#proposal input[required], #proposal select[required], #proposal textarea[required]');
      const submitBtn = document.getElementById('submitProposal');
      submitBtn.disabled = Array.from(inputs).some(input => !input.value);
    }
    document.querySelectorAll('#proposal input, #proposal select, #proposal textarea').forEach(input => {
      input.addEventListener('input', validateForm);
    });

    function checkOffline() {
      const syncBtn = document.getElementById('sync');
      if (!navigator.onLine) {
        syncBtn.style.background = '#6C757D';
        localStorage.setItem('offlineData', JSON.stringify({ projects: projects.length, funds: 20.5, allocated: 36.1 }));
      } else {
        syncBtn.style.background = '#28A745';
        localStorage.removeItem('offlineData');
      }
    }
    window.addEventListener('online', checkOffline);
    window.addEventListener('offline', checkOffline);
    checkOffline();

    function filterProjects() {
      const level = document.getElementById('level').value;
      const province = document.getElementById('province').value;
      const district = document.getElementById('district').value;
      const sector = document.getElementById('sector').value;
      const status = document.getElementById('status').value;
      const projectType = document.getElementById('project-type').value;

      let filtered = projects;
      if (level === 'province' && province !== 'all') {
        filtered = filtered.filter(p => p.province === province);
      }
      if (level === 'district' && district !== 'all') {
        filtered = filtered.filter(p => p.district === district);
      }
      if (sector !== 'all') {
        filtered = filtered.filter(p => p.sector === sector);
      }
      if (status !== 'all') {
        filtered = filtered.filter(p => p.status === status);
      }
      if (projectType !== 'all') {
        filtered = filtered.filter(p => p.projectType === projectType);
      }

      renderProjects(filtered);
      updateStatusChart(filtered);
    }

    function searchProjects() {
      const query = document.getElementById('search').value.toLowerCase();
      const filtered = projects.filter(p => p.name.toLowerCase().includes(query));
      renderProjects(filtered);
      updateStatusChart(filtered);
    }

    function renderProjects(filteredProjects) {
      document.getElementById('projectTable').innerHTML = filteredProjects.map(p => `
        <tr>
          <td>${p.name}</td>
          <td>${p.projectType}</td>
          <td>${p.province.charAt(0).toUpperCase() + p.province.slice(1)}</td>
          <td>${p.district.charAt(0).toUpperCase() + p.district.slice(1)}</td>
          <td>${p.sector.charAt(0).toUpperCase() + p.sector.slice(1)}</td>
          <td><div class="progress-bar"><div style="width: ${p.progress}%; background: ${
            p.status === 'completed' ? '#28A745' : p.status === 'ongoing' ? '#FFC107' : '#DC3545'
          };"></div></td>
          <td>ZMW ${p.funds.toLocaleString()}</td>
          <td><span style="color: ${
            p.status === 'completed' ? '#28A745' : p.status === 'ongoing' ? '#FFC107' : '#DC3545'
          };">${p.status.charAt(0).toUpperCase() + p.status.slice(1)}</span></td>
        </tr>
      `).join('');
    }

    function updateFilters() {
      const level = document.getElementById('level').value;
      const provinceSelect = document.getElementById('province');
      const districtSelect = document.getElementById('district');
      const constituencySelect = document.getElementById('constituency');
      const wardSelect = document.getElementById('ward');

      provinceSelect.style.display = 'none';
      districtSelect.style.display = 'none';
      constituencySelect.style.display = 'none';
      wardSelect.style.display = 'none';

      provinceSelect.value = 'all';
      districtSelect.value = 'all';
      constituencySelect.value = 'in-dev';
      wardSelect.value = 'in-dev';

      if (level === 'province') {
        provinceSelect.style.display = 'block';
      } else if (level === 'district') {
        districtSelect.style.display = 'block';
      } else if (level === 'constituency') {
        constituencySelect.style.display = 'block';
      } else if (level === 'ward') {
        wardSelect.style.display = 'block';
      }

      filterProjects();
    }

    function updateProjectDropdowns() {
      const feedbackProjectSelect = document.getElementById('feedbackProject');
      feedbackProjectSelect.innerHTML = '<option value="all">All Projects</option>' + 
        projects.map(p => 
          `<option value="${p.id}">${p.name} (${p.projectType})</option>`
        ).join('');
    }

    function toggleView(id) {
      const chart = document.getElementById(`${id}-chart`);
      const list = document.getElementById(`${id}-list`);
      const btn = chart.querySelector('.toggle-btn');
      if (chart.style.display !== 'none') {
        chart.style.display = 'none';
        list.style.display = 'block';
        btn.textContent = 'Show List'; // Ensure button text doesn't change
      } else {
        chart.style.display = 'block';
        list.style.display = 'none';
        btn.textContent = 'Show List';
      }
    }

    function showProjectDetails(projectId) {
      const project = projects.find(p => p.id === projectId);
      if (project) {
        // Navigate to Project Status dashboard
        document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
        document.querySelector('#project-status').classList.add('active');
        document.querySelectorAll('.footer a').forEach(a => a.classList.remove('active'));
        document.querySelector('.footer a[href="#project-status"]').classList.add('active');

        // Update filters to show only this project
        document.getElementById('level').value = 'national';
        document.getElementById('province').value = 'all';
        document.getElementById('district').value = 'all';
        document.getElementById('sector').value = project.sector;
        document.getElementById('status').value = project.status;
        document.getElementById('project-type').value = project.projectType;
        document.getElementById('search').value = project.name;

        // Update the table and chart
        const filtered = [project];
        renderProjects(filtered);
        updateStatusChart(filtered);

        // Scroll to the top of the Project Status dashboard
        document.querySelector('#project-status').scrollIntoView({ behavior: 'smooth' });
      }
    }

    function exportChart(chartId) {
      const canvas = document.getElementById(chartId);
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = `${chartId}.png`;
      link.click();
    }
    function resolveAlert() {
      console.log('Resolving alert...');
    }
    function goBack() {
      document.querySelector('#proposal').classList.remove('active');
      document.querySelector('#overview').classList.add('active');
    }
    function checkStatus() {
      const id = document.getElementById('statusId').value;
      const project = projects.find(p => p.id === id);
      document.getElementById('statusResult').textContent = project ? 
        `Status: ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}, ${project.progress}%` : 
        'Enter a valid ID';
    }
    function changeLanguage(lang) {
      console.log(`Language changed to: ${lang}`);
    }

    updateOverview();
    updateFilters();
    updateProjectDropdowns();
    filterProjects();
  </script>
</body>
</html>
