<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CDF Management Prototype</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #F8F9FA; }
    .header { background: #007BFF; color: white; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 16px; margin: 0; flex-grow: 1; text-align: center; }
    .header .logo, .header .user { font-size: 24px; }
    .content { padding: 10px; }
    .card { background: white; border: 1px solid #DEE2E6; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
    .card p { margin: 5px 0; font-size: 18px; }
    .card p span { font-weight: bold; }
    .chart-container { width: 100%; height: 150px; margin-bottom: 10px; }
    .list-container { display: none; margin-bottom: 10px; }
    .list-container ul { list-style: none; padding: 0; }
    .list-container li { padding: 8px; border-bottom: 1px solid #DEE2E6; font-size: 14px; }
    .map-container { width: 100%; height: 150px; }
    .filter-bar { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; align-items: center; }
    .filter-bar select, .filter-bar input { padding: 8px; font-size: 14px; border: 1px solid #DEE2E6; border-radius: 5px; }
    .filter-bar button { background: #007BFF; color: white; padding: 8px; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; }
    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { border: 1px solid #DEE2E6; padding: 8px; font-size: 12px; text-align: left; }
    .table th { background: #007BFF; color: white; }
    .progress-bar { background: #DEE2E6; height: 8px; border-radius: 4px; }
    .progress-bar div { height: 100%; border-radius: 4px; }
    .alerts { margin-bottom: 10px; }
    .alert { background: #DC3545; color: white; padding: 8px; margin: 5px 0; border-radius: 5px; font-size: 12px; }
    .alert button { background: #007BFF; color: white; border: none; padding: 5px; border-radius: 3px; cursor: pointer; }
    .form-section { margin-bottom: 10px; }
    .form-section label { display: block; font-size: 14px; margin-bottom: 5px; }
    .form-section input, .form-section select, .form-section textarea { width: 100%; padding: 8px; font-size: 16px; border: 1px solid #DEE2E6; border-radius: 5px; }
    .form-section button { background: #28A745; color: white; padding: 10px; font-size: 16px; border: none; border-radius: 5px; width: 100%; }
    .form-section button:disabled { background: #6C757D; }
    .footer { background: #F8F9FA; padding: 10px; display: flex; justify-content: space-around; border-top: 1px solid #DEE2E6; flex-wrap: wrap; }
    .footer a { color: #007BFF; font-size: 14px; text-decoration: none; display: flex; flex-direction: column; align-items: center; margin: 5px; }
    .footer a i { font-size: 24px; margin-bottom: 5px; }
    .footer a.active { color: #28A745; }
    .sync-btn { background: #28A745; color: white; padding: 5px; border-radius: 3px; font-size: 14px; margin: 5px; }
    .toggle-btn { background: #6C757D; color: white; padding: 5px 8px; border-radius: 5px; font-size: 12px; cursor: pointer; margin: 5px 0; }
    .screen { display: none; }
    .screen.active { display: block; }
    @media (min-width: 768px) {
      .content { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .chart-container, .list-container, .map-container { height: 200px; }
      .card { grid-column: span 1; }
      .footer { flex-wrap: nowrap; }
    }
  </style>
</head>
<body>
  <!-- Overview Dashboard -->
  <div id="overview" class="screen active">
    <div class="header">
      <i class="fas fa-map logo"></i>
      <h1>Lusaka CDF Overview</h1>
      <div class="user">
        <i class="fas fa-user-circle"></i>
        <select onchange="changeLanguage(this.value)">
          <option value="en">EN</option>
          <option value="bem">Bemba</option>
          <option value="nya">Nyanja</option>
          <option value="ton">Tonga</option>
        </select>
      </div>
    </div>
    <div class="content">
      <div class="card">
        <p><i class="fas fa-house-user"></i> Total Projects: <span id="totalProjects">25</span></p>
        <p><i class="fas fa-money-bill"></i> Funds Allocated: <span>ZMW 36.1M</span></p>
        <p><i class="fas fa-money-bill"></i> Funds Disbursed: <span>ZMW 20.5M</span></p>
        <p><i class="fas fa-balance-scale"></i> Funds Remaining: <span>ZMW 15.6M</span></p>
      </div>
      <button class="toggle-btn" onclick="toggleView('sector')">Show List</button>
      <div class="chart-container" id="sector-chart">
        <canvas id="sectorChart"></canvas>
        <button onclick="exportChart('sectorChart')">Export PNG</button>
      </div>
      <div class="list-container" id="sector-list">
        <ul id="sectorList"></ul>
      </div>
      <div class="map-container" id="map"></div>
    </div>
    <div class="footer">
      <a href="#overview" class="active"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
      <button class="sync-btn" id="sync">Sync Data</button>
    </div>
  </div>

  <!-- Project Status Dashboard -->
  <div id="project-status" class="screen">
    <div class="header">
      <i class="fas fa-map logo"></i>
      <h1>Project Status</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="filter-bar">
        <select id="level" onchange="updateFilters()">
          <option value="national">National</option>
          <option value="province">Province</option>
          <option value="district">District</option>
          <option value="constituency">Constituency</option>
          <option value="ward">Ward</option>
        </select>
        <select id="constituency" onchange="updateWards()">
          <option value="all">All Constituencies</option>
          <option value="lusaka">Lusaka</option>
          <option value="chilanga">Chilanga</option>
          <option value="kafue">Kafue</option>
        </select>
        <select id="ward" onchange="filterProjects()">
          <option value="all">All Wards</option>
        </select>
        <select id="sector" onchange="filterProjects()">
          <option value="all">All Sectors</option>
          <option value="education">Education</option>
          <option value="water">Water</option>
          <option value="skills">Skills</option>
          <option value="health">Health</option>
        </select>
        <select id="status" onchange="filterProjects()">
          <option value="all">All Status</option>
          <option value="ongoing">Ongoing</option>
          <option value="completed">Completed</option>
          <option value="delayed">Delayed</option>
        </select>
        <input id="search" type="text" placeholder="Search Project">
        <button onclick="filterProjects()">Apply</button>
        <button onclick="searchProjects()">Search</button>
      </div>
      <button class="toggle-btn" onclick="toggleView('status')">Show List</button>
      <div class="chart-container" id="status-chart">
        <canvas id="statusChart"></canvas>
        <button onclick="exportChart('statusChart')">Export PNG</button>
      </div>
      <div class="list-container" id="status-list">
        <ul id="statusList"></ul>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Constituency</th>
            <th>Ward</th>
            <th>Sector</th>
            <th>Progress</th>
            <th>Funds</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="projectTable"></tbody>
      </table>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status" class="active"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Financial Dashboard -->
  <div id="financial" class="screen">
    <div class="header">
      <i class="fas fa-map logo"></i>
      <h1>Financial Overview</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="card">
        <p><i class="fas fa-money-bill"></i> Funds Allocated: <span>ZMW 36.1M</span></p>
        <canvas id="gaugeChart" height="100"></canvas>
        <p style="text-align: center; font-size: 18px;">ZMW 20.5M / 36.1M</p>
      </div>
      <button class="toggle-btn" onclick="toggleView('trend')">Show List</button>
      <div class="chart-container" id="trend-chart">
        <canvas id="trendChart"></canvas>
        <button onclick="exportChart('trendChart')">Export PNG</button>
      </div>
      <div class="list-container" id="trend-list">
        <ul>
          <li>Jan: ZMW 5M</li>
          <li>Feb: ZMW 10M</li>
          <li>Mar: ZMW 15M</li>
          <li>Apr: ZMW 20.5M</li>
        </ul>
      </div>
      <div class="alerts">
        <div class="alert">Overdue: School ZMW 200K <button onclick="resolveAlert()">Resolve</button></div>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Action</th>
            <th>Project</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>10/04/25</td>
            <td>Site Visit</td>
            <td>Borehole</td>
            <td>OK</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial" class="active"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Project Proposal Form -->
  <div id="proposal" class="screen">
    <div class="header">
      <i class="fas fa-arrow-left" onclick="goBack()"></i>
      <h1>Submit CDF Project Proposal</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="form-section">
        <label>Project Type</label>
        <select required>
          <option value="">Select</option>
          <option value="school">School</option>
          <option value="borehole">Borehole</option>
          <option value="skills">Skills Training</option>
        </select>
      </div>
      <div class="form-section">
        <label>Project Name</label>
        <input type="text" placeholder="e.g., Kanyama Clinic" required>
      </div>
      <div class="form-section">
        <label>Description</label>
        <textarea placeholder="Describe the project..." maxlength="200" required></textarea>
      </div>
      <div class="form-section">
        <label>Budget (ZMW)</label>
        <input type="number" placeholder="e.g., 500000" required>
      </div>
      <div class="form-section">
        <label>Start Date</label>
        <input type="date" required>
      </div>
      <div class="form-section">
        <label>Community Endorsement</label>
        <input type="text" placeholder="e.g., Ward meeting 10/04/25" required>
      </div>
      <div class="form-section">
        <label>Photo/Letter</label>
        <input type="file" accept=".jpg,.pdf">
      </div>
      <div class="form-section">
        <button id="submitProposal" disabled>Submit Proposal</button>
      </div>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal" class="active"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback"><i class="fas fa-comment"></i> Feedback</a>
    </div>
  </div>

  <!-- Community Feedback Interface -->
  <div id="feedback" class="screen">
    <div class="header">
      <i class="fas fa-map logo"></i>
      <h1>Community Feedback</h1>
      <div class="user"><i class="fas fa-user-circle"></i></div>
    </div>
    <div class="content">
      <div class="form-section">
        <label>Project</label>
        <select required>
          <option value="all">All Projects</option>
          <option value="borehole">Kanyama Borehole</option>
          <option value="school">Lusaka School</option>
        </select>
      </div>
      <div class="form-section">
        <label>Issue Type</label>
        <select required>
          <option value="">Select</option>
          <option value="quality">Quality</option>
          <option value="delay">Delay</option>
          <option value="misuse">Misuse</option>
        </select>
      </div>
      <div class="form-section">
        <label>Details</label>
        <textarea placeholder="Describe the issue..." maxlength="150" required></textarea>
      </div>
      <div class="form-section">
        <label>Photo (Optional)</label>
        <input type="file" accept=".jpg">
      </div>
      <div class="form-section">
        <label><input type="checkbox" checked> Submit Anonymously</label>
      </div>
      <div class="form-section">
        <button id="submitFeedback">Send Feedback</button>
      </div>
      <div class="form-section">
        <label>Check Project Status</label>
        <input type="text" placeholder="Enter Project ID" id="statusId">
        <button onclick="checkStatus()">Check</button>
        <p id="statusResult"></p>
      </div>
    </div>
    <div class="footer">
      <a href="#overview"><i class="fas fa-home"></i> Overview</a>
      <a href="#project-status"><i class="fas fa-tasks"></i> Projects</a>
      <a href="#financial"><i class="fas fa-wallet"></i> Financial</a>
      <a href="#proposal"><i class="fas fa-file-alt"></i> Proposal</a>
      <a href="#feedback" class="active"><i class="fas fa-comment"></i> Feedback</a>
      <p>Contact: +260 123 456 789</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Dummy Data
    const projects = [
      // Lusaka Constituency
      { id: 'L1', name: 'Kanyama Borehole', constituency: 'lusaka', ward: 'kanyama', sector: 'water', progress: 75, funds: 400000, status: 'ongoing', lat: -15.3875, lng: 28.3228 },
      { id: 'L2', name: 'Kanyama School', constituency: 'lusaka', ward: 'kanyama', sector: 'education', progress: 100, funds: 600000, status: 'completed', lat: -15.3876, lng: 28.3229 },
      { id: 'L3', name: 'Kanyama Clinic', constituency: 'lusaka', ward: 'kanyama', sector: 'health', progress: 30, funds: 300000, status: 'ongoing', lat: -15.3877, lng: 28.3230 },
      { id: 'L4', name: 'Kanyama Skills Training', constituency: 'lusaka', ward: 'kanyama', sector: 'skills', progress: 10, funds: 200000, status: 'delayed', lat: -15.3878, lng: 28.3231 },
      { id: 'L5', name: 'Materos Borehole', constituency: 'lusaka', ward: 'materos', sector: 'water', progress: 90, funds: 450000, status: 'ongoing', lat: -15.3975, lng: 28.3328 },
      { id: 'L6', name: 'Materos School', constituency: 'lusaka', ward: 'materos', sector: 'education', progress: 50, funds: 500000, status: 'ongoing', lat: -15.3976, lng: 28.3329 },
      { id: 'L7', name: 'Materos Clinic', constituency: 'lusaka', ward: 'materos', sector: 'health', progress: 20, funds: 250000, status: 'delayed', lat: -15.3977, lng: 28.3330 },
      { id: 'L8', name: 'Materos Skills Training', constituency: 'lusaka', ward: 'materos', sector: 'skills', progress: 85, funds: 300000, status: 'ongoing', lat: -15.3978, lng: 28.3331 },
      // Chilanga Constituency
      { id: 'C1', name: 'Chilanga Borehole', constituency: 'chilanga', ward: 'chilanga central', sector: 'water', progress: 60, funds: 380000, status: 'ongoing', lat: -15.6075, lng: 28.2828 },
      { id: 'C2', name: 'Chilanga School', constituency: 'chilanga', ward: 'chilanga central', sector: 'education', progress: 95, funds: 550000, status: 'completed', lat: -15.6076, lng: 28.2829 },
      { id: 'C3', name: 'Chilanga Clinic', constituency: 'chilanga', ward: 'chilanga central', sector: 'health', progress: 40, funds: 320000, status: 'ongoing', lat: -15.6077, lng: 28.2830 },
      { id: 'C4', name: 'Chilanga Skills Training', constituency: 'chilanga', ward: 'chilanga central', sector: 'skills', progress: 5, funds: 150000, status: 'delayed', lat: -15.6078, lng: 28.2831 },
      { id: 'C5', name: 'Mapepe Borehole', constituency: 'chilanga', ward: 'mapepe', sector: 'water', progress: 70, funds: 400000, status: 'ongoing', lat: -15.6175, lng: 28.2928 },
      { id: 'C6', name: 'Mapepe School', constituency: 'chilanga', ward: 'mapepe', sector: 'education', progress: 25, funds: 450000, status: 'ongoing', lat: -15.6176, lng: 28.2929 },
      { id: 'C7', name: 'Mapepe Clinic', constituency: 'chilanga', ward: 'mapepe', sector: 'health', progress: 80, funds: 350000, status: 'ongoing', lat: -15.6177, lng: 28.2930 },
      { id: 'C8', name: 'Mapepe Skills Training', constituency: 'chilanga', ward: 'mapepe', sector: 'skills', progress: 15, funds: 180000, status: 'delayed', lat: -15.6178, lng: 28.2931 },
      // Kafue Constituency
      { id: 'K1', name: 'Kafue Borehole', constituency: 'kafue', ward: 'kafue urban', sector: 'water', progress: 85, funds: 420000, status: 'ongoing', lat: -15.7675, lng: 28.1828 },
      { id: 'K2', name: 'Kafue School', constituency: 'kafue', ward: 'kafue urban', sector: 'education', progress: 100, funds: 600000, status: 'completed', lat: -15.7676, lng: 28.1829 },
      { id: 'K3', name: 'Kafue Clinic', constituency: 'kafue', ward: 'kafue urban', sector: 'health', progress: 55, funds: 340000, status: 'ongoing', lat: -15.7677, lng: 28.1830 },
      { id: 'K4', name: 'Kafue Skills Training', constituency: 'kafue', ward: 'kafue urban', sector: 'skills', progress: 30, funds: 200000, status: 'ongoing', lat: -15.7678, lng: 28.1831 },
      { id: 'K5', name: 'Shikoswe Borehole', constituency: 'kafue', ward: 'shikoswe', sector: 'water', progress: 45, funds: 390000, status: 'ongoing', lat: -15.7775, lng: 28.1928 },
      { id: 'K6', name: 'Shikoswe School', constituency: 'kafue', ward: 'shikoswe', sector: 'education', progress: 90, funds: 580000, status: 'completed', lat: -15.7776, lng: 28.1929 },
      { id: 'K7', name: 'Shikoswe Clinic', constituency: 'kafue', ward: 'shikoswe', sector: 'health', progress: 10, funds: 280000, status: 'delayed', lat: -15.7777, lng: 28.1930 },
      { id: 'K8', name: 'Shikoswe Skills Training', constituency: 'kafue', ward: 'shikoswe', sector: 'skills', progress: 65, funds: 250000, status: 'ongoing', lat: -15.7778, lng: 28.1931 }
    ];

    // Navigation
    document.querySelectorAll('.footer a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
        document.querySelector(link.getAttribute('href')).classList.add('active');
        document.querySelectorAll('.footer a').forEach(a => a.classList.remove('active'));
        link.classList.add('active');
      });
    });

    // Overview Chart
    function updateOverview() {
      const sectorCounts = {
        education: 0, water: 0, skills: 0, health: 0
      };
      projects.forEach(p => sectorCounts[p.sector] += p.funds / 36100000 * 100);
      const sectorData = Object.values(sectorCounts);
      const sectorLabels = ['Education', 'Water', 'Skills', 'Health'];
      sectorChart.data.datasets[0].data = sectorData;
      sectorChart.update();
      document.getElementById('sectorList').innerHTML = sectorLabels.map((label, i) => 
        `<li>${label}: ${sectorData[i].toFixed(1)}% (ZMW ${(sectorData[i] * 361000).toFixed(0)})</li>`
      ).join('');
      document.getElementById('totalProjects').textContent = projects.length;
    }
    const sectorChart = new Chart(document.getElementById('sectorChart'), {
      type: 'pie',
      data: {
        labels: ['Education', 'Water', 'Skills', 'Health'],
        datasets: [{
          data: [0, 0, 0, 0],
          backgroundColor: ['#007BFF', '#28A745', '#FD7E14', '#DC3545']
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    // Map
    const map = L.map('map').setView([-15.3875, 28.3228], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);
    projects.forEach(p => {
      L.marker([p.lat, p.lng]).addTo(map).bindPopup(`${p.name} - ${p.status}`);
    });

    // Project Status Chart
    function updateStatusChart(filteredProjects) {
      const statusCounts = { completed: 0, ongoing: 0, delayed: 0 };
      filteredProjects.forEach(p => statusCounts[p.status]++);
      statusChart.data.datasets[0].data = Object.values(statusCounts);
      statusChart.update();
      document.getElementById('statusList').innerHTML = `
        <li>Completed: ${statusCounts.completed} Projects</li>
        <li>Ongoing: ${statusCounts.ongoing} Projects</li>
        <li>Delayed: ${statusCounts.delayed} Projects</li>
      `;
    }
    const statusChart = new Chart(document.getElementById('statusChart'), {
      type: 'bar',
      data: {
        labels: ['Completed', 'Ongoing', 'Delayed'],
        datasets: [{
          label: 'Projects',
          data: [0, 0, 0],
          backgroundColor: ['#28A745', '#FFC107', '#DC3545']
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    // Financial Gauge
    const gaugeChart = new Chart(document.getElementById('gaugeChart'), {
      type: 'doughnut',
      data: {
        datasets: [{
          data: [20.5, 15.6],
          backgroundColor: ['#28A745', '#DEE2E6'],
          borderWidth: 0
        }]
      },
      options: { rotation: -90, circumference: 180, cutout: '80%', responsive: true }
    });

    // Financial Trend
    const trendChart = new Chart(document.getElementById('trendChart'), {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr'],
        datasets: [{
          label: 'Disbursed (ZMW)',
          data: [5, 10, 15, 20.5],
          borderColor: '#28A745',
          fill: false
        }]
      },
      options: { responsive: true, maintainAspectRatio: false }
    });

    // Form Validation
    function validateForm() {
      const inputs = document.querySelectorAll('#proposal input[required], #proposal select[required], #proposal textarea[required]');
      const submitBtn = document.getElementById('submitProposal');
      submitBtn.disabled = Array.from(inputs).some(input => !input.value);
    }
    document.querySelectorAll('#proposal input, #proposal select, #proposal textarea').forEach(input => {
      input.addEventListener('input', validateForm);
    });

    // Offline Simulation
    function checkOffline() {
      const syncBtn = document.getElementById('sync');
      if (!navigator.onLine) {
        syncBtn.style.background = '#6C757D';
        localStorage.setItem('offlineData', JSON.stringify({ projects: projects.length, funds: 20.5, allocated: 36.1 }));
      } else {
        syncBtn.style.background = '#28A745';
        localStorage.removeItem('offlineData');
      }
    }
    window.addEventListener('online', checkOffline);
    window.addEventListener('offline', checkOffline);
    checkOffline();

    // Filter and Search
    function filterProjects() {
      const level = document.getElementById('level').value;
      const constituency = document.getElementById('constituency').value;
      const ward = document.getElementById('ward').value;
      const sector = document.getElementById('sector').value;
      const status = document.getElementById('status').value;
      let filtered = projects;
      if (level === 'constituency' && constituency !== 'all') filtered = filtered.filter(p => p.constituency === constituency);
      if (level === 'ward' && ward !== 'all') filtered = filtered.filter(p => p.ward === ward);
      if (sector !== 'all') filtered = filtered.filter(p => p.sector === sector);
      if (status !== 'all') filtered = filtered.filter(p => p.status === status);
      renderProjects(filtered);
      updateStatusChart(filtered);
    }

    function searchProjects() {
      const query = document.getElementById('search').value.toLowerCase();
      const filtered = query ? projects.filter(p => p.name.toLowerCase().includes(query)) : projects;
      renderProjects(filtered);
      updateStatusChart(filtered);
    }

    function renderProjects(filteredProjects) {
      document.getElementById('projectTable').innerHTML = filteredProjects.map(p => `
        <tr>
          <td>${p.name}</td>
          <td>${p.constituency.charAt(0).toUpperCase() + p.constituency.slice(1)}</td>
          <td>${p.ward.charAt(0).toUpperCase() + p.ward.slice(1)}</td>
          <td>${p.sector.charAt(0).toUpperCase() + p.sector.slice(1)}</td>
          <td><div class="progress-bar"><div style="width: ${p.progress}%; background: ${
            p.status === 'completed' ? '#28A745' : p.status === 'ongoing' ? '#FFC107' : '#DC3545'
          };"></div></td>
          <td>ZMW ${p.funds.toLocaleString()}</td>
          <td><span style="color: ${
            p.status === 'completed' ? '#28A745' : p.status === 'ongoing' ? '#FFC107' : '#DC3545'
          };">${p.status.charAt(0).toUpperCase() + p.status.slice(1)}</span></td>
        </tr>
      `).join('');
    }

    function updateFilters() {
      const level = document.getElementById('level').value;
      const constituencySelect = document.getElementById('constituency');
      const wardSelect = document.getElementById('ward');
      if (level === 'national' || level === 'province' || level === 'district') {
        constituencySelect.value = 'all';
        wardSelect.innerHTML = '<option value="all">All Wards</option>';
      } else if (level === 'constituency') {
        wardSelect.innerHTML = '<option value="all">All Wards</option>';
      } else if (level === 'ward') {
        updateWards();
      }
    }

    function updateWards() {
      const constituency = document.getElementById('constituency').value;
      const wardSelect = document.getElementById('ward');
      const wards = {
        lusaka: ['kanyama', 'materos'],
        chilanga: ['chilanga central', 'mapepe'],
        kafue: ['kafue urban', 'shikoswe']
      };
      wardSelect.innerHTML = '<option value="all">All Wards</option>' + 
        (constituency === 'all' ? '' : wards[constituency].map(w => 
          `<option value="${w}">${w.charAt(0).toUpperCase() + w.slice(1)}</option>`
        ).join(''));
      filterProjects();
    }

    // Toggle Chart/List
    function toggleView(id) {
      const chart = document.getElementById(`${id}-chart`);
      const list = document.getElementById(`${id}-list`);
      const btn = chart.parentElement.querySelector('.toggle-btn');
      if (chart.style.display !== 'none') {
        chart.style.display = 'none';
        list.style.display = 'block';
        btn.textContent = 'Show Chart';
      } else {
        chart.style.display = 'block';
        list.style.display = 'none';
        btn.textContent = 'Show List';
      }
    }

    // Placeholder Functions
    function exportChart(chartId) {
      const canvas = document.getElementById(chartId);
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = `${chartId}.png`;
      link.click();
    }
    function resolveAlert() {
      console.log('Resolving alert...');
    }
    function goBack() {
      document.querySelector('#proposal').classList.remove('active');
      document.querySelector('#overview').classList.add('active');
    }
    function checkStatus() {
      const id = document.getElementById('statusId').value;
      const project = projects.find(p => p.id === id);
      document.getElementById('statusResult').textContent = project ? 
        `Status: ${project.status.charAt(0).toUpperCase() + project.status.slice(1)}, ${project.progress}%` : 
        'Enter a valid ID';
    }
    function changeLanguage(lang) {
      console.log(`Language changed to: ${lang}`);
    }

    // Initialize
    updateOverview();
    renderProjects(projects);
    updateStatusChart(projects);
    updateWards();
  </script>
</body>
</html>
